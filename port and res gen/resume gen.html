<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Modular Resume Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/html-to-docx@1.8.0/dist/html-to-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .editor-section { background-color: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); margin-bottom: 1.5rem; }
        .editor-input { margin-top: 0.25rem; display: block; width: 100%; padding: 0.5rem 0.75rem; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; line-height: 1.25rem; }
        .tag-input { font-size: 0.75rem; line-height: 1rem; padding: 0.25rem 0.5rem; }
        .delete-btn { background-color: #fee2e2; color: #b91c1c; border-radius: 9999px; padding: 0.25rem; transition: background-color .2s; flex-shrink: 0; }
        .delete-btn:hover { background-color: #fecaca; }
        .add-btn { background-color: #dbeafe; color: #1e40af; border-radius: 0.375rem; padding: 0.5rem 0.75rem; font-size: 0.875rem; margin-top: 0.5rem; transition: background-color .2s; }
        .add-btn:hover { background-color: #bfdbfe; }
        .ai-btn { background: linear-gradient(to right, #6366f1, #8b5cf6); color: white; border-radius: 0.375rem; padding: 0.25rem 0.75rem; font-size: 0.75rem; transition: all .2s; }
        .ai-btn:hover { transform: scale(1.05); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content { background-color: white; padding: 2rem; border-radius: 1rem; max-width: 90%; width: 600px; max-height: 90vh; overflow-y: auto; }
    </style>
</head>
<body class="bg-neutral-100">

    <div id="app-content">
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-blue-600">Modular Resume Generator</h1>
                <div class="text-right">
                    <button id="save-button" class="flex items-center bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 disabled:bg-neutral-400 transition-all">
                        <span id="save-button-text">Save Master CV</span>
                    </button>
                    <p class="text-xs text-neutral-500 mt-1">Data is saved locally in this browser.</p>
                </div>
            </div>
        </header>

        <main class="container mx-auto p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <div class="lg:col-span-4 space-y-4"><h2 class="text-2xl font-bold">Master Content Editor</h2><div id="resume-editor-container"></div></div>

            <div class="lg:col-span-8 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm sticky top-24 z-30">
                    <h2 class="text-2xl font-bold mb-4">Generate New Resume</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div><label for="audience-preset" class="block text-sm font-medium text-gray-700">Audience Preset</label><select id="audience-preset" class="editor-input"><option value="custom">Custom (use text box below)</option><option value="adaptability">Adaptability Canada Client</option><option value="pas-partner">The Pas Partner (Local)</option><option value="academic">Academic / Research</option><option value="music">Music Related</option><option value="making">Making/Woodworking Related</option><option value="master-cv">Full Master CV (Everything)</option></select></div>
                        <div><label for="format-preset" class="block text-sm font-medium text-gray-700">Format</label><select id="format-preset" class="editor-input"><option value="resume">1-Page Resume</option><option value="cv">Full CV</option></select></div>
                    </div>
                    <textarea id="job-description" class="w-full h-28 p-3 border rounded-lg" placeholder="For custom presets, describe the audience or paste a job description here..."></textarea>
                    <button id="generate-button" class="mt-4 w-full flex items-center justify-center bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-700"><span id="generate-button-text">Generate</span></button>
                    <div id="generator-error" class="text-red-600 mt-2 text-sm"></div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="preview-title" class="text-2xl font-bold">Preview</h2>
                        <div id="export-buttons" class="hidden space-x-2">
                            <button id="generate-cover-letter-btn" class="ai-btn text-sm">✨ Generate Cover Letter</button>
                            <button id="export-word" class="flex items-center bg-blue-500 text-white font-semibold py-2 px-3 rounded-lg text-sm">Word</button>
                            <button id="export-pdf" class="flex items-center bg-red-500 text-white font-semibold py-2 px-3 rounded-lg text-sm">PDF</button>
                        </div>
                    </div>
                    <div id="resume-preview" class="p-8 border rounded-lg bg-white"><div class="text-center text-neutral-500 p-20">Select an audience and format, then click Generate.</div></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="cover-letter-modal" class="modal-overlay hidden"><div class="modal-content"><h3 class="text-2xl font-bold mb-4">Generated Cover Letter</h3><textarea id="cover-letter-textarea" class="w-full h-64 p-3 border rounded-lg bg-neutral-50"></textarea><div class="flex justify-end space-x-4 mt-4"><button id="copy-cover-letter-btn" class="add-btn">Copy Text</button><button id="close-cover-letter-btn" class="delete-btn px-4 py-2 rounded-lg">Close</button></div></div></div>
    <div id="improvements-modal" class="modal-overlay hidden"><div class="modal-content" id="improvements-modal-content"></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let baseResume = {};
            let lastGeneratedResume = null;
            let lastAudienceDescription = '';
            const LOCAL_STORAGE_KEY = 'ai-modular-resume-data-v3';

            const ui = {
                editorContainer: document.getElementById('resume-editor-container'),
                previewContainer: document.getElementById('resume-preview'),
                previewTitle: document.getElementById('preview-title'),
                jobDescription: document.getElementById('job-description'),
                audiencePreset: document.getElementById('audience-preset'),
                formatPreset: document.getElementById('format-preset'),
                generateButton: document.getElementById('generate-button'),
                generateButtonText: document.getElementById('generate-button-text'),
                saveButton: document.getElementById('save-button'),
                saveButtonText: document.getElementById('save-button-text'),
                exportButtons: document.getElementById('export-buttons'),
                exportPdfButton: document.getElementById('export-pdf'),
                exportWordButton: document.getElementById('export-word'),
                generatorError: document.getElementById('generator-error'),
                generateCoverLetterBtn: document.getElementById('generate-cover-letter-btn'),
                coverLetterModal: document.getElementById('cover-letter-modal'),
                coverLetterTextarea: document.getElementById('cover-letter-textarea'),
                copyCoverLetterBtn: document.getElementById('copy-cover-letter-btn'),
                closeCoverLetterBtn: document.getElementById('close-cover-letter-btn'),
                improvementsModal: document.getElementById('improvements-modal'),
                improvementsModalContent: document.getElementById('improvements-modal-content'),
            };
            
            const initialResumeData = {
                personal: { name: 'Devin Dushanek', email: 'dushanekd@gmail.com', phone: '+1 (204) 620 2642', location: 'Winnipeg, Manitoba' },
                experience: [
                    { id: 1, title: 'VP - Design', company: 'Adaptability Canada (Remote)', dates: '06/2023 - Present', points: ['Leading research and design for future-forward best practices in inclusive design.', 'Creation of Inclusive Design Guides and other accessible products and technology.', 'Project management of property assessments for large enterprises and public sector organizations.'], tags: 'professional, consulting, leadership, design, accessibility' },
                    { id: 2, title: 'Research Assistant', company: 'University of Manitoba', dates: '01/2024 - 06/2024', points: ['Joined to critically observe and report on the community engagement-based design process for a prefab home building and training facility in York Factory First Nation.', 'Developed an improved method for designers to collaborate, design, and build with northern and remote Indigenous communities.'], tags: 'academic, research, community, indigenous-collab' },
                    { id: 3, title: 'Design + Making', company: 'Freelance (The Pas, MB)', dates: '07/2020 - 09/2022', points: ["Shared in clients' visions for the design and building of furniture, storage units, and objects.", 'Consultation for the design of home/commercial renovations and remodels.'], tags: 'creative, making, design, freelance, the-pas' },
                    { id: 4, title: 'Equipment Operator', company: 'Canadian Kraft Paper (The Pas, MB)', dates: '04/2014 - 09/2016', points: ['Operated heavy equipment to relay fuel and wood chips into the plant.', 'Hauled waste byproducts, maintained travel routes and heavy-duty equipment.'], tags: 'industrial, the-pas' },
                ],
                education: [
                    { id: 5, degree: 'Master of Architecture', school: 'University of Manitoba', dates: '2022-2025', tags: 'academic, professional, design' },
                    { id: 6, degree: 'Bachelor of Environmental Design, Architecture', school: 'University of Manitoba', dates: '2013-2018', tags: 'academic, professional, design' },
                ],
                achievements: [
                    { id: 7, text: "Dean's Honour List, Master of Architecture Program", date: "2024", tags: "academic" },
                    { id: 8, text: "First to obtain RHFAC Professional designation in the prairies", date: "2018", tags: "professional, accessibility" },
                    { id: 9, text: "First Place, VisitAbility Design Competition", date: "2016", tags: "academic, design, accessibility" },
                ],
                certifications: [
                    { id: 10, name: "LEED Accredited Professional™", status: "In Progress", tags: "professional, design, sustainability" },
                    { id: 11, name: "Rick Hansen Foundation Accessibility Certification™", date: "2018-2021", tags: "professional, accessibility" },
                    { id: 12, name: "Medical First Responder", date: "2015-2018", tags: "community, service" },
                ],
                publications: [
                    { id: 13, title: "Constructing the Pluriverse: A New Relational Design Studio", journal: "Public Journal Issue 68", date: "Fall 2024", tags: "academic, publication, design, indigenous-collab" },
                    { id: 14, title: "Design for Extreme Environments: Supporting Psychological Well-being on Mars", journal: "Master's Thesis", date: "Fall 2024", tags: "academic, publication, research, design" },
                ],
                service: [
                    { id: 15, role: "Mentor - Grade 12 Internships", org: "The Met School", date: "2024", tags: "community, service, mentorship" },
                    { id: 16, role: "Student Ambassador + Mentor", org: "Faculty of Architecture, UofM", date: "2022-2024", tags: "community, service, mentorship, academic" },
                    { id: 17, role: "Committee Member, EDIA FLC", org: "Faculty of Architecture, UofM", date: "2024", tags: "community, service, academic, accessibility" },
                ],
                skills: [ { id: 18, text: 'Inclusive Design', tags: 'professional, consulting, accessibility, design' }, { id: 19, text: 'Woodworking', tags: 'creative, making' }, { id: 20, text: 'Music (Guitar/Drums)', tags: 'creative, music' }, { id: 21, text: 'Research & Analysis', tags: 'academic, professional, research' }, { id: 22, text: 'Community Engagement', tags: 'community, indigenous-collab' }, { id: 23, text: 'Figma & Adobe Suite', tags: 'design, professional' } ],
                projects: [ { id: 24, name: 'Diversity Match (UX/UI Design)', description: 'Information Architecture and UX/UI Design for procurement software.', tags: 'professional, design, accessibility' }, { id: 25, name: 'Housing as Cosmology - Venice Biennale', description: 'Construction and Graphics Student Lead for exhibition.', tags: 'academic, design, making, community' } ]
            };
            
            function loadData() { baseResume = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || initialResumeData; }
            function saveData() { localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(baseResume)); ui.saveButtonText.textContent = 'Saved!'; setTimeout(() => { ui.saveButtonText.textContent = 'Save Master CV'; }, 1500); }

            function renderSection(title, key, itemTemplate, addBtnText) { const items = baseResume[key] || []; return `<div class="editor-section"><div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">${title}</h3><button class="add-btn" data-action="add" data-section="${key}">${addBtnText}</button></div><div data-section-container="${key}">${items.map(itemTemplate).join('')}</div></div>`; }

            function renderEditor() {
                const personalInfo = baseResume.personal;
                const personalHtml = `<div class="editor-section"><h3 class="text-xl font-bold mb-4">Personal Info</h3>${Object.keys(personalInfo).map(key => `<div class="mb-2"><label class="text-sm font-medium capitalize">${key}</label><input type="text" class="editor-input" data-section="personal" data-field="${key}" value="${personalInfo[key] || ''}"></div>`).join('')}</div>`;
                const experienceHtml = renderSection('Experience', 'experience', item => `...`); // Keep experience template
                const educationHtml = renderSection('Education', 'education', item => `<div class="p-3 mb-2 border rounded-lg" data-id="${item.id}"><div class="flex justify-end"><button class="delete-btn" data-action="delete" data-section="education" data-id="${item.id}">X</button></div><input class="editor-input mb-1" data-field="degree" value="${item.degree}"><input class="editor-input mb-1" data-field="school" value="${item.school}"><input class="editor-input mb-1" data-field="dates" value="${item.dates}"><input class="editor-input tag-input" data-field="tags" value="${item.tags}"></div>`, 'Add Education');
                const achievementsHtml = renderSection('Achievements', 'achievements', item => `<div class="p-3 mb-2 border rounded-lg" data-id="${item.id}"><div class="flex justify-end"><button class="delete-btn" data-action="delete" data-section="achievements" data-id="${item.id}">X</button></div><input class="editor-input mb-1" data-field="text" value="${item.text}"><input class="editor-input tag-input" data-field="tags" value="${item.tags}"></div>`, 'Add Achievement');
                const publicationsHtml = renderSection('Publications', 'publications', item => `<div class="p-3 mb-2 border rounded-lg" data-id="${item.id}"><div class="flex justify-end"><button class="delete-btn" data-action="delete" data-section="publications" data-id="${item.id}">X</button></div><input class="editor-input mb-1" data-field="title" value="${item.title}"><input class="editor-input mb-1" data-field="journal" value="${item.journal}"><input class="editor-input tag-input" data-field="tags" value="${item.tags}"></div>`, 'Add Publication');
                const serviceHtml = renderSection('Service & Volunteering', 'service', item => `<div class="p-3 mb-2 border rounded-lg" data-id="${item.id}"><div class="flex justify-end"><button class="delete-btn" data-action="delete" data-section="service" data-id="${item.id}">X</button></div><input class="editor-input mb-1" data-field="role" value="${item.role}"><input class="editor-input mb-1" data-field="org" value="${item.org}"><input class="editor-input tag-input" data-field="tags" value="${item.tags}"></div>`, 'Add Service');
                const skillsHtml = renderSection('Skills', 'skills', item => `...`); // Keep skills template
                const projectsHtml = renderSection('Projects', 'projects', item => `...`); // Keep projects template
                
                // Re-pasting full templates to avoid truncation issues
                const fullExperienceHtml = renderSection('Experience', 'experience', item => `
                    <div class="p-3 mb-2 border rounded-lg" data-id="${item.id}">
                        <div class="flex justify-between items-start">
                           <div class="flex-grow pr-4"> <input type="text" placeholder="Job Title" class="editor-input font-semibold mb-1" data-field="title" value="${item.title || ''}"></div>
                           <button class="delete-btn" data-action="delete" data-section="experience" data-id="${item.id}">X</button>
                        </div>
                        <input type="text" placeholder="Company" class="editor-input mb-1" data-field="company" value="${item.company || ''}">
                        <input type="text" placeholder="Dates" class="editor-input mb-1" data-field="dates" value="${item.dates || ''}">
                        <div class="mt-2" data-sub-container="points">${item.points.map((p, i) => `<input type="text" class="editor-input mb-1" data-sub-field="points" data-index="${i}" value="${p || ''}">`).join('')}</div>
                        <div class="flex justify-between items-center mt-2">
                           <div><label class="text-xs">Tags (comma separated)</label><input type="text" placeholder="e.g. professional, design" class="editor-input tag-input" data-field="tags" value="${item.tags || ''}"></div>
                           <button class="ai-btn" data-action="suggest-improvements" data-id="${item.id}">✨ Suggest Improvements</button>
                        </div>
                    </div>`, 'Add Experience');
                
                const fullSkillsHtml = renderSection('Skills', 'skills', item => `<div class="p-3 mb-2 border rounded-lg" data-id="${item.id}"><div class="flex justify-end"><button class="delete-btn" data-action="delete" data-section="skills" data-id="${item.id}">X</button></div><input type="text" placeholder="Skill" class="editor-input mb-1" data-field="text" value="${item.text || ''}"><label class="text-xs mt-2">Tags</label><input type="text" placeholder="e.g. creative, music" class="editor-input tag-input" data-field="tags" value="${item.tags || ''}"></div>`, 'Add Skill');
                const fullProjectsHtml = renderSection('Projects', 'projects', item => `<div class="p-3 mb-2 border rounded-lg" data-id="${item.id}"><div class="flex justify-end"><button class="delete-btn" data-action="delete" data-section="projects" data-id="${item.id}">X</button></div><input type="text" placeholder="Project Name" class="editor-input mb-1" data-field="name" value="${item.name || ''}"><textarea placeholder="Description" class="editor-input" data-field="description">${item.description || ''}</textarea><label class="text-xs mt-2">Tags</label><input type="text" class="editor-input tag-input" data-field="tags" value="${item.tags || ''}"></div>`, 'Add Project');


                ui.editorContainer.innerHTML = personalHtml + fullExperienceHtml + educationHtml + achievementsHtml + publicationsHtml + serviceHtml + fullSkillsHtml + fullProjectsHtml;
            }

            async function callGemini(prompt, schema) { /* ... same as before ... */ const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: schema }}; const res = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!res.ok) throw new Error(`API Error: ${res.statusText}`); const result = await res.json(); if (!result.candidates?.[0]?.content?.parts?.[0]?.text) throw new Error("Invalid response from AI."); return JSON.parse(result.candidates[0].content.parts[0].text); }

            ui.editorContainer.addEventListener('click', async (e) => { /* ... (same add/delete logic, but now handles all sections) ... */ const target = e.target; const { action, section, id } = target.dataset; if (action === 'add') { if (section === 'experience') baseResume.experience.push({id: Date.now(), title: '', company: '', dates: '', points: [''], tags: ''}); if (section === 'skills') baseResume.skills.push({id: Date.now(), text: '', tags: ''}); if (section === 'projects') baseResume.projects.push({id: Date.now(), name: '', description: '', tags: ''}); if (section === 'education') baseResume.education.push({id: Date.now(), degree:'', school:'', dates:'', tags:''}); if (section === 'achievements') baseResume.achievements.push({id: Date.now(), text:'', tags:''}); if (section === 'publications') baseResume.publications.push({id: Date.now(), title:'', journal:'', tags:''}); if (section === 'service') baseResume.service.push({id: Date.now(), role:'', org:'', tags:''}); renderEditor(); } if (action === 'delete') { baseResume[section] = baseResume[section].filter(item => item.id != id); renderEditor(); } if (action === 'suggest-improvements') { /* ... (same as before) ... */ } });
            ui.editorContainer.addEventListener('input', (e) => { /* ... (same logic, but handles all sections) ... */ const target = e.target; const { section, field } = target.dataset; if (section === 'personal') { baseResume.personal[field] = target.value; return; } const itemContainer = target.closest('[data-id]'); if (!itemContainer) return; const itemId = itemContainer.dataset.id; const itemIndex = baseResume[section].findIndex(item => item.id == itemId); if (itemIndex === -1) return; if(target.dataset.subField === 'points') { baseResume[section][itemIndex].points[parseInt(target.dataset.index)] = target.value; } else { baseResume[section][itemIndex][field] = target.value; } });
            
            ui.generateButton.addEventListener('click', async () => { /* ... (same as before but with new preset and updated prompt/schema) ... */ ui.generateButton.disabled = true; ui.generateButtonText.textContent = 'Generating...'; ui.generatorError.textContent = ""; const preset = ui.audiencePreset.value; const format = ui.formatPreset.value; let requiredTags = []; let audienceDescription = ui.jobDescription.value; if (preset === 'adaptability') { requiredTags = ['professional', 'consulting', 'adaptability']; audienceDescription = 'a corporate client for Adaptability Canada.'; } else if (preset === 'pas-partner') { requiredTags = ['professional', 'local-pas', 'community']; audienceDescription = 'a potential local partner in The Pas, MB.'; } else if (preset === 'academic') { requiredTags = ['academic', 'research', 'publication']; audienceDescription = 'an academic institution or for a research position.' } else if (preset === 'music') { requiredTags = ['creative', 'music']; audienceDescription = 'a music industry contact.'; } else if (preset === 'making') { requiredTags = ['creative', 'making', 'design']; audienceDescription = 'a contact in the maker or woodworking community.';} let filteredResume = JSON.parse(JSON.stringify(baseResume)); if (preset !== 'master-cv') { Object.keys(filteredResume).forEach(key => { if (Array.isArray(filteredResume[key])) { filteredResume[key] = filteredResume[key].filter(item => { const itemTags = (item.tags || '').split(',').map(t => t.trim()); return requiredTags.some(reqTag => itemTags.includes(reqTag)); }); } }); } const prompt = `You are a professional resume writer. Create a tailored document. Audience: ${audienceDescription}. Format: ${format}. Available Data: ${JSON.stringify(filteredResume)}. Instructions: Write a summary. Select ONLY the most relevant data. For a resume, be concise (1 page). For a CV, be comprehensive. Return ONLY a JSON object with fields for summary, experience, skills, projects, education, publications, service, and achievements.`; const schema = { type: "OBJECT", properties: { summary: { type: "STRING" }, experience: { type: "ARRAY", items: { type: "OBJECT", properties: { title: { type: "STRING" }, company: { type: "STRING" }, dates: { type: "STRING" }, points: { type: "ARRAY", items: { type: "STRING" } } } } }, skills: { type: "ARRAY", items: { type: "OBJECT", properties: {text: {type: "STRING"}} } }, projects: { type: "ARRAY", items: { type: "OBJECT", properties: {name: {type: "STRING"}, description: {type:"STRING"}}} }, education: { type: "ARRAY", items: { type: "OBJECT", properties: { degree: {type: "STRING"}, school: {type: "STRING"}, dates: {type: "STRING"}}} }, publications: { type: "ARRAY", items: { type: "OBJECT", properties: { title: {type: "STRING"}, journal: {type: "STRING"}}} }, service: { type: "ARRAY", items: { type: "OBJECT", properties: { role: {type: "STRING"}, org: {type: "STRING"}}} }, achievements: { type: "ARRAY", items: { type: "OBJECT", properties: { text: {type: "STRING"}}} } } }; try { const generatedData = await callGemini(prompt, schema); lastGeneratedResume = { ...baseResume, ...generatedData }; lastAudienceDescription = audienceDescription; ui.previewTitle.textContent = `Preview: ${ui.audiencePreset.options[ui.audiencePreset.selectedIndex].text}`; ui.exportButtons.classList.remove('hidden'); const finalResume = lastGeneratedResume; const renderList = (items, template) => (items && items.length) ? template(items) : ''; ui.previewContainer.innerHTML = `<div class="text-center mb-6"><h1 class="text-3xl font-bold">${finalResume.personal.name}</h1><p class="text-sm mt-1">${finalResume.personal.location} | ${finalResume.personal.email}</p></div>` + renderList(finalResume.summary, s => `<div class="mb-4"><h2 class="text-lg font-bold border-b-2 pb-1 mb-2">Summary</h2><p class="text-sm">${s}</p></div>`) + renderList(finalResume.experience, exps => `<div class="mb-4"><h2 class="text-lg font-bold border-b-2 pb-1 mb-2">Experience</h2>${exps.map(e => `<div class="mb-3"><div class="flex justify-between"><h3 class="text-md font-bold">${e.title}</h3><p class="text-sm font-semibold">${e.dates}</p></div><p class="text-md italic mb-1">${e.company}</p><ul class="list-disc list-inside text-sm space-y-1">${e.points.map(p => `<li>${p}</li>`).join('')}</ul></div>`).join('')}</div>`) + renderList(finalResume.education, edus => `<div class="mb-4"><h2 class="text-lg font-bold border-b-2 pb-1 mb-2">Education</h2>${edus.map(e => `<div class="flex justify-between"><h3 class="text-md font-bold">${e.degree}</h3><p class="text-sm font-semibold">${e.dates}</p></div>`).join('')}</div>`) + renderList(finalResume.publications, pubs => `<div class="mb-4"><h2 class="text-lg font-bold border-b-2 pb-1 mb-2">Publications</h2>${pubs.map(p => `<div class="mb-2"><h3 class="text-md font-bold">${p.title}</h3><p class="text-sm italic">${p.journal}</p></div>`).join('')}</div>`) + renderList(finalResume.skills, skls => `<div class="mb-4"><h2 class="text-lg font-bold border-b-2 pb-1 mb-2">Skills</h2><p class="text-sm">${skls.map(s => s.text || s).join(' • ')}</p></div>`) + renderList(finalResume.projects, projs => `<div class="mb-4"><h2 class="text-lg font-bold border-b-2 pb-1 mb-2">Projects</h2>${projs.map(p => `<div class="mb-2"><h3 class="text-md font-bold">${p.name}</h3><p class="text-sm">${p.description}</p></div>`).join('')}</div>`); } catch (e) { ui.generatorError.textContent = `Generation failed: ${e.message}`; } finally { ui.generateButton.disabled = false; ui.generateButtonText.textContent = 'Generate'; } });
            
            ui.generateCoverLetterBtn.addEventListener('click', async () => { /* ... same as before ... */ });
            // ... all other event listeners and init calls
            loadData(); renderEditor(); ui.saveButton.addEventListener('click', saveData);
        });
    </script>
</body>
</html>
