<!DOCTYPE html>
<html lang="en" class="bg-cream">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevLabs | Modular Resume Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/html-to-docx@1.8.0/dist/html-to-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        .font-heading { font-family: 'Poppins', sans-serif; letter-spacing: -0.03em; }
        .font-body { font-family: 'Varela Round', sans-serif; }
        body { font-family: 'Varela Round', sans-serif; background-color: #f7f4ed; }
        
        .bg-lab-green { background-color: #20c997; }
        .bg-lab-green:hover { background-color: #1aa883; }

        .editor-section { background-color: white; border: 1px solid #e5e7eb; padding: 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05); }
        .editor-input { margin-top: 0.25rem; display: block; width: 100%; padding: 0.5rem 0.75rem; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem; line-height: 1.25rem; color: #1f2937; }
        .editor-input::placeholder { color: #9ca3af; }
        
        .delete-btn { background-color: #f3f4f6; color: #9ca3af; border-radius: 9999px; transition: all .2s; flex-shrink: 0; border: 1px solid #e5e7eb; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }
        .delete-btn:hover { background-color: #fee2e2; color: #ef4444; border-color: #fca5a5; }
        
        .add-btn { background-color: #f3f4f6; color: #4b5563; border-radius: 0.5rem; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; transition: all .2s; border: 1px solid #d1d5db; }
        .add-btn:hover { background-color: #e5e7eb; border-color: #9ca3af; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 50; backdrop-filter: blur(4px); }
        .modal-content { background-color: white; padding: 2rem; border-radius: 1rem; max-width: 90%; width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }
        
        details > summary { list-style: none; cursor: pointer; }
        details > summary::-webkit-details-marker { display: none; }

        #suggest-edit-btn { position: absolute; display: none; background: linear-gradient(to right, #6366f1, #8b5cf6); color: white; border-radius: 0.375rem; padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; border: none; cursor: pointer; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); z-index: 100; }
        
        /* New Tag Input Styles */
        .tag-container { display: flex; flex-wrap: wrap; align-items: center; gap: 0.5rem; padding: 0.5rem; background-color: #f9fafb; border: 1px solid #d1d5db; border-radius: 0.5rem; }
        .tag-bubble { display: inline-flex; align-items: center; background-color: #e0e7ff; color: #4338ca; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
        .tag-delete { margin-left: 0.5rem; cursor: pointer; color: #6366f1; }
        .tag-delete:hover { color: #4338ca; }
        .tag-input { flex-grow: 1; border: none; background: transparent; padding: 0.25rem; font-size: 0.875rem; outline: none; }
        .tag-input:focus { ring: 0; }
    </style>
     <script>
        tailwind.config = {
            theme: {
                extend: { colors: { 'cream': '#f7f4ed', 'lab-teal': '#20c997', 'lab-magenta': '#e83e8c', 'lab-gold': '#ffc107', 'lab-purple': '#6f42c1' } }
            }
        }
    </script>
</head>
<body class="bg-cream text-gray-800 font-body">

    <div id="app-content">
        <!-- Header -->
        <header class="sticky top-0 z-40 bg-white/95 backdrop-blur-sm shadow-md">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                 <h1 class="font-heading text-2xl font-black text-black">
                    DEV<span style="color:#20c997">L</span><span style="color:#e83e8c">A</span><span style="color:#ffc107">B</span><span style="color:#6f42c1">S</span> <span class="text-gray-400 font-light">| Resume Generator</span>
                </h1>
                <div class="text-right">
                    <button id="save-button" class="flex items-center bg-black text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-800 disabled:bg-slate-500 transition-all">
                        <span id="save-button-text">Save Master Data</span>
                    </button>
                    <p class="text-xs text-slate-500 mt-1">Data is saved locally in this browser.</p>
                </div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <main class="container mx-auto p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <div class="lg:col-span-4 space-y-4">
                <h2 class="text-2xl font-heading font-bold text-gray-900">Master Content Editor</h2>
                <div id="resume-editor-container"></div>
            </div>
            <div class="lg:col-span-8 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-heading font-bold mb-4 text-gray-900">Generate New Resume</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="audience-preset" class="block text-sm font-medium text-gray-700">Audience Preset</label>
                            <div class="flex items-center space-x-2">
                               <select id="audience-preset" class="editor-input w-full"></select>
                               <button id="manage-presets-btn" class="p-2 bg-gray-200 hover:bg-gray-300 rounded-md transition" title="Manage Presets">⚙️</button>
                            </div>
                        </div>
                        <div>
                            <label for="format-preset" class="block text-sm font-medium text-gray-700">Format</label>
                            <select id="format-preset" class="editor-input"><option value="resume">1-Page Resume</option><option value="cv">Full CV</option></select>
                        </div>
                    </div>
                    <textarea id="job-description" class="w-full h-28 p-3 border rounded-lg bg-gray-50 border-gray-300 text-gray-800 placeholder-gray-500" placeholder="For custom presets, describe the audience or paste a job description here..."></textarea>
                    <div class="mt-4 flex items-center">
                        <input id="ai-rewrite-toggle" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" checked>
                        <label for="ai-rewrite-toggle" class="ml-2 block text-sm text-gray-900">Let AI tailor content for audience</label>
                    </div>
                    <button id="generate-button" class="mt-4 w-full flex items-center justify-center bg-lab-green text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform hover:scale-105"><span id="generate-button-text">Generate</span></button>
                    <div id="generator-error" class="text-red-600 mt-2 text-sm"></div>
                </div>
                <div class="bg-white border border-gray-200 p-6 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="preview-title" class="text-2xl font-heading font-bold text-gray-900">Preview</h2>
                        <div id="export-container" class="relative hidden">
                            <button id="export-dropdown-btn" class="bg-gray-700 hover:bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all flex items-center">Export <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                            <div id="export-options" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 hidden">
                                <a href="#" id="export-word" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Word (.docx)</a>
                                <a href="#" id="export-pdf" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">PDF (.pdf)</a>
                                <a href="#" id="export-excel" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Excel (.csv)</a>
                                <a href="#" id="export-html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">HTML (.html)</a>
                            </div>
                        </div>
                    </div>
                    <div id="resume-preview-wrapper" class="bg-white text-black p-8 border rounded-lg border-gray-200">
                        <div id="resume-preview" class="prose max-w-none"><div class="text-center text-slate-500 p-20">Select an audience and format, then click Generate.</div></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="preset-manager-modal" class="modal-overlay hidden">
        <div class="modal-content"><div class="flex justify-between items-center mb-4"><h3 class="text-2xl font-heading font-bold text-gray-900">Manage Presets</h3><button id="close-preset-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button></div><div id="preset-list" class="space-y-4 mb-6"></div><div class="bg-gray-50 p-4 rounded-lg"><h4 class="text-lg font-bold mb-2">Add New Preset</h4><input id="new-preset-name" type="text" class="editor-input mb-2" placeholder="Preset Name (e.g., 'UX Design Role')"><textarea id="new-preset-tags" class="editor-input h-20" placeholder="Comma-separated tags (e.g., inclusive-design, professional, ux)"></textarea><button id="add-preset-btn" class="add-btn mt-2">+ Add Preset</button></div></div>
    </div>
    <div id="suggestions-modal" class="modal-overlay hidden">
        <div class="modal-content"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-heading font-bold text-gray-900">AI Writing Suggestion</h3><button id="close-suggestions-modal-btn" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button></div><div id="suggestions-content" class="mb-6"></div><div class="flex justify-end"><button id="use-suggestion-btn" class="hidden bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700">Use this suggestion</button></div></div>
    </div>
    
    <button id="suggest-edit-btn">✨ Suggest Edit</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let appData = { resume: {}, presets: {} };
            let savedSelection = null;
            const LOCAL_STORAGE_KEY = 'modular-resume-data-v8';

            const ui = {
                editorContainer: document.getElementById('resume-editor-container'),
                previewContainer: document.getElementById('resume-preview'),
                previewTitle: document.getElementById('preview-title'),
                jobDescription: document.getElementById('job-description'),
                audiencePreset: document.getElementById('audience-preset'),
                formatPreset: document.getElementById('format-preset'),
                generateButton: document.getElementById('generate-button'),
                generateButtonText: document.getElementById('generate-button-text'),
                saveButton: document.getElementById('save-button'),
                saveButtonText: document.getElementById('save-button-text'),
                exportContainer: document.getElementById('export-container'),
                exportDropdownBtn: document.getElementById('export-dropdown-btn'),
                exportOptions: document.getElementById('export-options'),
                exportPdfButton: document.getElementById('export-pdf'),
                exportWordButton: document.getElementById('export-word'),
                exportExcelButton: document.getElementById('export-excel'),
                exportHtmlButton: document.getElementById('export-html'),
                generatorError: document.getElementById('generator-error'),
                managePresetsBtn: document.getElementById('manage-presets-btn'),
                presetModal: document.getElementById('preset-manager-modal'),
                closePresetModalBtn: document.getElementById('close-preset-modal-btn'),
                presetList: document.getElementById('preset-list'),
                newPresetName: document.getElementById('new-preset-name'),
                newPresetTags: document.getElementById('new-preset-tags'),
                addPresetBtn: document.getElementById('add-preset-btn'),
                aiRewriteToggle: document.getElementById('ai-rewrite-toggle'),
                suggestEditBtn: document.getElementById('suggest-edit-btn'),
                suggestionsModal: document.getElementById('suggestions-modal'),
                suggestionsContent: document.getElementById('suggestions-content'),
                closeSuggestionsModalBtn: document.getElementById('close-suggestions-modal-btn'),
                useSuggestionBtn: document.getElementById('use-suggestion-btn'),
            };
            
            const initialResumeData = {
                personal: { name: 'Devin Dushanek', credentials: 'M.Arch. Cand., B.EnvD.', email: 'dushanekd@gmail.com', phone: '+1 [204] 620 2642', location: 'Winnipeg, Manitoba' },
                summary: { default: "7 years of experience using inclusive design methods to improve the lived experience of people from different cultural backgrounds and across the disability spectrum... Driven by a curiosity for problem-solving through making things, I am working to develop a conscious approach to architecture that encourages connection to self, others, and the environments that surround them." },
                experience: [ { id: 'exp1', title: 'VP - Design', company: 'Adaptability Canada [Remote]', dates: '06/2023 - Present', points: ['Leading research and design for future-forward best practices in inclusive design...', 'Creation of Inclusive Design Guides and other accessible products and technology...'], tags: ['leadership', 'inclusive-design', 'consulting', 'professional'] }, { id: 'exp2', title: 'Research Assistant', company: 'University of Manitoba', dates: '01/2024 - 06/2024', points: ['For the development of a prefab home building and training facility in York Factory First Nation...'], tags: ['academic', 'research', 'community'] }, { id: 'exp3', title: 'Design + Making', company: 'Freelance', dates: '07/2020 - 09/2022', points: ["Shared in clients' visions for the design and building of furniture...", "Consultation for home/commercial renovations..."], tags: ['freelance', 'making', 'woodworking', 'design'] }, ],
                education: [ { id: 'edu1', degree: 'Master of Architecture', school: 'University of Manitoba', dates: '2022-2025', tags: ['academic', 'architecture'] }, { id: 'edu2', degree: 'Bachelor of Environmental Design, Architecture', school: 'University of Manitoba', dates: '2013-2018', tags: ['academic', 'architecture'] } ],
                achievements: [ { id: 'ach1', text: "Dean's Honour List", org: "University of Manitoba", date: "2023-2024", tags: ["academic"] }, { id: 'ach2', text: "First to obtain RHFAC Professional designation in the prairies", org: "Rick Hansen Foundation", date: "2018", tags: ["professional", "inclusive-design"] } ],
                skills: [ { id: 'ski1', category: 'Research & Strategy', items: 'research + analysis, collaboration, problem-solving, synthesis + theory', tags: ['professional', 'academic'] }, { id: 'ski2', category: 'Design & Software', items: 'graphic visualization, figma, photoshop, indesign, illustrator', tags: ['professional', 'design'] } ],
            };
            const initialPresets = { 'custom': { name: 'Custom (use text box)', tags: [] }, 'inclusive-design': { name: 'Inclusive Design Consulting', tags: ['inclusive-design', 'consulting'] }, 'architecture': { name: 'Architecture Firm', tags: ['architecture', 'design', 'making'] }, 'academic': { name: 'Academic / Research', tags: ['academic', 'research'] }, 'community': { name: 'Community/Non-Profit', tags: ['community', 'service'] }, 'everything': { name: 'Everything', tags: [] }, };
            
            function migrateTags(data) {
                Object.values(data).forEach(section => {
                    if(Array.isArray(section)) {
                        section.forEach(item => {
                            if (typeof item.tags === 'string') {
                                item.tags = item.tags.split(',').map(t => t.trim()).filter(Boolean);
                            }
                        });
                    }
                });
            }

            function loadData() {
                const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                let dataIsValid = false;
                if (savedData) { try { const parsed = JSON.parse(savedData); if (parsed && parsed.resume && parsed.resume.summary && parsed.presets) { appData = parsed; migrateTags(appData.resume); dataIsValid = true; } } catch (e) { console.error("Failed to parse saved data, resetting.", e); } }
                if (!dataIsValid) { appData.resume = JSON.parse(JSON.stringify(initialResumeData)); appData.presets = JSON.parse(JSON.stringify(initialPresets)); }
            }
            
            function saveData() { localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(appData)); ui.saveButtonText.textContent = 'Saved!'; setTimeout(() => { ui.saveButtonText.textContent = 'Save Master Data'; }, 1500); }

            function renderTags(sectionKey, itemId) {
                const item = appData.resume[sectionKey].find(i => i.id === itemId);
                const tagsHtml = (item.tags || []).map(tag => `<span class="tag-bubble">${tag}<span class="tag-delete" data-action="delete-tag" data-tag-value="${tag}">&times;</span></span>`).join('');
                return `<div class="mt-2"><label class="text-xs text-gray-500">Tags</label><div class="tag-container" data-section="${sectionKey}" data-id="${itemId}">${tagsHtml}<input type="text" class="tag-input" placeholder="Add a tag..."></div></div>`;
            }

            function renderSection(title, key, itemTemplate, addBtnText) {
                const items = appData.resume[key] || [];
                const itemsHtml = items.map(item => itemTemplate(item)).join('');
                return `<details class="editor-section" open><summary class="flex justify-between items-center mb-4"><h3 class="text-xl font-heading font-bold text-gray-800">${title}</h3><svg class="w-6 h-6 transform transition-transform text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></summary><div data-section-container="${key}">${itemsHtml}</div>${addBtnText ? `<button class="add-btn mt-4" data-action="add" data-section="${key}">+ Add ${addBtnText}</button>` : ''}</details>`;
            }

            function renderEditor() {
                const { resume } = appData;
                const deleteButtonHtml = (s, id) => `<div class="absolute top-2 right-2"><button class="delete-btn" data-action="delete" data-section="${s}" data-id="${id}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>`;
                const personalHtml = `<div class="editor-section"><h3 class="text-xl font-heading font-bold mb-4">Personal Info</h3>${Object.keys(resume.personal).map(k=>`<div class="mb-2"><label class="text-sm font-medium capitalize text-gray-600">${k}</label><input type="text" class="editor-input" data-section="personal" data-field="${k}" value="${resume.personal[k]||''}"></div>`).join('')}</div>`;
                const summaryHtml = `<div class="editor-section"><h3 class="text-xl font-heading font-bold mb-4">Default Summary</h3><textarea class="editor-input h-32" data-section="summary" data-field="default">${resume.summary.default||''}</textarea></div>`;
                const simpleTemplate = (key, placeholders) => (i) => `<div class="relative p-4 mb-3 border rounded-lg bg-gray-50" data-id="${i.id}">${deleteButtonHtml(key, i.id)}${Object.keys(placeholders).map(field => `<input class="editor-input mb-2" data-field="${field}" value="${i[field]||''}" placeholder="${placeholders[field]}">`).join('')}${renderTags(key, i.id)}</div>`;
                const experienceTemplate = i => `<div class="relative p-4 mb-3 border rounded-lg bg-gray-50" data-id="${i.id}">${deleteButtonHtml('experience',i.id)}<input type="text" placeholder="Job Title" class="editor-input font-semibold mb-2" data-field="title" value="${i.title||''}"><input type="text" placeholder="Company" class="editor-input mb-2" data-field="company" value="${i.company||''}"><input type="text" placeholder="Dates" class="editor-input mb-2" data-field="dates" value="${i.dates||''}"><div class="mt-2 space-y-2">${(i.points||[]).map((p,idx)=>`<textarea placeholder="Accomplishment" class="editor-input text-sm h-16" data-sub-field="points" data-index="${idx}">${p||''}</textarea>`).join('')}</div>${renderTags('experience', i.id)}</div>`;
                const sections = {
                    experience: renderSection('Experience', 'experience', experienceTemplate, 'Experience'),
                    education: renderSection('Education', 'education', simpleTemplate('education', {degree: 'Degree', school: 'School', dates: 'Dates'}), 'Education'),
                    projects: renderSection('Projects', 'projects', simpleTemplate('projects', {name: 'Project Name', role: 'Your Role', org: 'Organization', date: 'Date'}), 'Project'),
                    skills: renderSection('Skills', 'skills', i => `<div class="relative p-4 mb-3 border rounded-lg bg-gray-50" data-id="${i.id}">${deleteButtonHtml('skills', i.id)}<input class="editor-input mb-2" data-field="category" value="${i.category||''}" placeholder="Category"><textarea class="editor-input h-20" data-field="items" placeholder="Comma separated items">${i.items||''}</textarea>${renderTags('skills', i.id)}</div>`, 'Skill Category'),
                    publications: renderSection('Publications', 'publications', i => `<div class="relative p-4 mb-3 border rounded-lg bg-gray-50" data-id="${i.id}">${deleteButtonHtml('publications', i.id)}<input class="editor-input mb-2" data-field="title" value="${i.title||''}" placeholder="Title"><input class="editor-input mb-2" data-field="journal" value="${i.journal||''}" placeholder="Journal/Platform"><textarea class="editor-input mb-2" data-field="description" placeholder="Description">${i.description||''}</textarea>${renderTags('publications', i.id)}</div>`, 'Publication'),
                    service: renderSection('Service & Community', 'service', simpleTemplate('service', {role: 'Role', org: 'Organization', date: 'Date'}), 'Service'),
                    achievements: renderSection('Achievements', 'achievements', simpleTemplate('achievements', {text: 'Achievement', org: 'Organization', date: 'Date'}), 'Achievement'),
                    certifications: renderSection('Certifications', 'certifications', simpleTemplate('certifications', {name: 'Certification Name', org: 'Issuing Organization', dates: 'Date/Range'}), 'Certification'),
                    courses: renderSection('Courses & Workshops', 'courses', simpleTemplate('courses', {name: 'Course Name', org: 'Organization', date: 'Date'}), 'Course'),
                };
                ui.editorContainer.innerHTML = personalHtml + summaryHtml + Object.values(sections).join('');
            }
            
            async function callGemini(prompt, schema) { /* ... same as before ... */ }

            function renderPresets() { /* ... same as before ... */ }
            ui.managePresetsBtn.addEventListener('click', () => ui.presetModal.classList.remove('hidden'));
            ui.closePresetModalBtn.addEventListener('click', () => ui.presetModal.classList.add('hidden'));
            ui.addPresetBtn.addEventListener('click', () => { /* ... same as before ... */ });
            ui.presetList.addEventListener('click', (e) => { if (e.target.closest('[data-action="delete-preset"]')) { delete appData.presets[e.target.closest('[data-action="delete-preset"]').dataset.key]; renderPresets(); saveData(); } });

            ui.editorContainer.addEventListener('input', (e) => { /* ... same as before ... */ });
            ui.editorContainer.addEventListener('click', (e) => {
                const target = e.target.closest('[data-action]');
                if (!target) return;
                const { action, section, id, tagValue } = target.dataset;
                if (action === 'delete') { appData.resume[section] = appData.resume[section].filter(item => item.id != id); renderEditor(); } 
                else if (action === 'add') { const newItem = { id: `new${Date.now()}`, tags: [] }; const sectionDefaults = { experience: { points: [''] } }; appData.resume[section].push({...newItem, ...sectionDefaults[section]}); renderEditor(); }
                else if (action === 'delete-tag') { const itemContainer = e.target.closest('[data-id]'); const item = appData.resume[itemContainer.dataset.section].find(i => i.id == itemContainer.dataset.id); item.tags = item.tags.filter(t => t !== tagValue); renderEditor(); }
            });
             ui.editorContainer.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && e.target.classList.contains('tag-input')) {
                    e.preventDefault();
                    const tagValue = e.target.value.trim();
                    if (tagValue) {
                        const itemContainer = e.target.closest('[data-id]');
                        const item = appData.resume[itemContainer.dataset.section].find(i => i.id == itemContainer.dataset.id);
                        if (!item.tags.includes(tagValue)) { item.tags.push(tagValue); }
                        e.target.value = '';
                        renderEditor();
                    }
                }
            });

            ui.generateButton.addEventListener('click', async () => { /* ... same as before, with preset name fix */ });
            
            function renderPreview(data) { /* ... same as before ... */ }
            
            document.addEventListener('mouseup', (e) => { /* ... same as before ... */ });

            ui.suggestEditBtn.addEventListener('click', async () => {
                ui.suggestionsModal.classList.remove('hidden');
                ui.suggestEditBtn.style.display = 'none'; // Hide button when modal opens
                /* ... rest of function */
            });

            ui.closeSuggestionsModalBtn.addEventListener('click', () => { ui.suggestionsModal.classList.add('hidden'); });
            ui.useSuggestionBtn.addEventListener('click', () => { /* ... same as before ... */ });

            ui.exportDropdownBtn.addEventListener('click', () => ui.exportOptions.classList.toggle('hidden'));
            window.addEventListener('click', (e) => { if (!ui.exportContainer.contains(e.target)) ui.exportOptions.classList.add('hidden'); });
            ui.exportPdfButton.addEventListener('click', (e) => { /* ... same as before ... */ });
            ui.exportWordButton.addEventListener('click', async (e) => { /* ... same as before ... */ });
            ui.exportHtmlButton.addEventListener('click', (e) => { /* ... same as before ... */ });
            ui.exportExcelButton.addEventListener('click', (e) => { /* ... same as before ... */ });
            
            loadData();
            renderEditor();
            renderPresets();
            ui.saveButton.addEventListener('click', saveData);
        });
    </script>
</body>
</html>

